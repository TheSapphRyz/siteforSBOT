<!DOCTYPE html>
<html>
<head>
    <title>Телеграм-бот</title>
</head>
<body>
    <h1>Мое веб-приложение для Телеграм-бота</h1>
    <input type="text" id="message-input" placeholder="Введите сообщение">
    <button id="send-button">Отправить в бота</button>
    <div id="output"></div>

    <script>
        const TOKEN = '7121996431:AAG9_-LyjNxwPTbLjx9eR9vRClAe1XeHd28'; // Вставь свой API-ключ Телеграм-бота

        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const outputDiv = document.getElementById('output');

        let CHAT_ID = null; // Будем хранить чат-айди здесь

        sendButton.addEventListener('click', () => {
            const message = messageInput.value.trim();
            if (message) {
                sendMessageToBot(message)
                    .then(() => {
                        outputDiv.textContent = 'Сообщение отправлено!';
                        messageInput.value = '';
                    })
                    .catch((error) => {
                        outputDiv.textContent = 'Ошибка при отправке сообщения: ' + error.message;
                    });
            }
        });

        // Функция для получения чат-айди от Телеграм-бота
        async function getChatId() {
            const response = await fetch(`https://api.telegram.org/bot${TOKEN}/getUpdates`);
            const data = await response.json();

            if (data.ok && data.result.length > 0) {
                const lastUpdate = data.result[data.result.length - 1];
                return lastUpdate.message.chat.id;
            }

            throw new Error('Не удалось получить чат-айди');
        }

        // Функция для отправки сообщения в Телеграм-бота
        async function sendMessageToBot(message) {
            if (CHAT_ID === null) {
                CHAT_ID = await getChatId();
            }

            const response = await fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    chat_id: CHAT_ID,
                    text: message
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP error ${response.status}`);
            }

            const data = await response.json();
            return data.result;
        }

        // Получаем чат-айди при загрузке страницы
        getChatId()
            .then((chatId) => {
                CHAT_ID = chatId;
                console.log(`Чат-айди: ${CHAT_ID}`);
            })
            .catch((error) => {
                outputDiv.textContent = 'Ошибка при получении чат-айди: ' + error.message;
            });
    </script>
</body>
</html>
